package edu.vision.se;

import org.junit.Test;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.fail;

import java.io.ByteArrayInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.lang.reflect.Constructor;
import org.apache.commons.fileupload.FileUploadException;
import org.apache.commons.fileupload.servlet.ServletFileUpload;
import org.apache.commons.fileupload.disk.DiskFileItemFactory;
import org.apache.commons.fileupload.FileUploadBase;

import org.springframework.mock.web.MockHttpServletRequest;
import org.springframework.mock.web.MockHttpServletResponse;

public class Testcase1 {

    @Test
    public void testPartHeaderSizeMaxLimit()
            throws IOException, FileUploadException {
        int headerSize = 200_000_000;
        StringBuilder sb = new StringBuilder(headerSize + 200);
        sb.append("-----1234\r\n");
        sb.append("X-Long-Header: ");
        for (int i = 0; i < headerSize; i++) sb.append('A');
        sb.append("\r\n");
        sb.append("Content-Disposition: form-data; name=\"file\"; filename=\"foo\"\r\n");
        sb.append("Content-Type: text/plain\r\n\r\n");
        sb.append("body\r\n");
        sb.append("-----1234--\r\n");

        String request = sb.toString();

        final ServletFileUpload upload = new ServletFileUpload(new DiskFileItemFactory());
        upload.setFileSizeMax(-1);
        upload.setSizeMax(-1);

        MockHttpServletRequest req = new MockHttpServletRequest();
        req.setContent(request.getBytes("US-ASCII"));
        req.setContentType("multipart/form-data; boundary=---1234");
        upload.parseRequest(req);
    }
}